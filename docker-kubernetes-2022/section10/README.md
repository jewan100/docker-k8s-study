# Docker Core

## Image & Container

### Container

- 격리된 실행 단위, 프로세스를 감싸는 박스 개념임
- 기본 파일 시스템은 휘발성임
  - 컨테이너 종료, 삭제 시 내부 데이터 소멸 가능성 존재
  - 영속 데이터는 Volume, Bind Mount로 외부에 저장 필요
  - 호스트 디렉터리를 컨테이너와 동기화하는 것을 미러링 개념으로 이해 가능함
- 하나의 컨테이너는 하나의 역할, 하나의 태스크에 집중하도록 구성하는 것이 권장 패턴임
- 가볍고 빠르게 생성, 삭제 가능해 재현성과 확장성이 높음
- 컨테이너는 항상 특정 Image를 기반으로 생성되는 실행 인스턴스임

### Image

- Dockerfile을 기반으로 빌드되는 템플릿, 블루프린트 역할임
- 하나의 동일한 Image에서 여러 컨테이너를 동시에 실행 가능함
- 애플리케이션 코드, 런타임, 라이브러리, OS 레이어 등 실행에 필요한 환경을 포함함
- Image 자체는 읽기 전용 레이어로 구성되며, 컨테이너 실행 시 쓰기 가능한 레이어가 위에 추가됨
- 레지스트리(Docker Hub 등)를 통해 손쉽게 공유, 배포 가능함

## Network

- 기본 bridge 네트워크 사용 시, 컨테이너에서 외부 인터넷(WWW)으로의 아웃바운드 통신은 기본적으로 허용 상태임
- 컨테이너끼리 직접 통신할 때는
  - 단순히 컨테이너 IP 주소 사용 가능하지만, 재시작 시 변경 가능성이 있어 실무에서는 잘 사용하지 않음
  - 사용자 정의 네트워크 또는 Docker Compose 기본 네트워크에 묶어서 컨테이너 이름을 호스트명처럼 사용하는 방식이 일반적임
- 외부(브라우저, 다른 서버)에서 컨테이너로 접근할 때는
  - `호스트포트:컨테이너포트` 형태의 포트 매핑 설정 필요함

## Compose

- 매번 `docker run`, `docker network`, `docker volume` 명령을 반복 입력하는 번거로움 감소 목적의 도구임
- 컨테이너 시작 구성을 YAML 파일(`docker-compose.yml`, `compose.yaml`)에 선언적으로 기록해 관리함
- 여러 컨테이너(웹, 백엔드, DB 등)를 하나의 애플리케이션 단위로 정의하고 한 번에 실행, 중지하는 데 적합함
- 단일 호스트 환경의 오케스트레이션 도구 역할을 하며, Kubernetes 등과는 범위와 목적이 다름

## Local Host(Development) & Remote Host(Production)

### Local Host / Development

- 개발자의 로컬 환경에서 애플리케이션을 격리해 실행하는 용도
- 컨테이너에 개발 환경을 캡슐화해, 팀원 간 동일한 개발 환경 보장 가능함
- 코드 변경 내용을 바로 반영하기 위해 Bind Mount로 소스 디렉터리를 컨테이너에 연결하는 패턴이 일반적임
- 각 프로젝트가 자체 컨테이너 세트를 사용하므로 상호 종속성이 줄어들고, 시스템 전체와 환경 충돌이 최소화됨
- 실험, 디버깅, 빠른 리셋이 쉬운 재현 가능한 개발 환경 제공 목적임

### Remote Host / Production

- 클라우드, 서버 등 원격 호스트에서 실제 서비스 트래픽을 처리하는 실행 환경임
- 동일한 Image를 사용해 개발, 테스트, 운영 환경 간 일관성 확보 가능함
- 배포 시에는 새로운 버전의 Image를 pull하고 컨테이너만 교체하면 되므로 업데이트 절차가 단순화됨
- 로깅, 모니터링, 보안(Secrets, TLS) 등 운영 관점 설정이 추가로 고려되어야 함
- 무중단 배포, 롤백, 스케일링 전략과 함께 설계 필요함

## Deployment Considerations

- 개발 vs 운영에서 마운트 전략 구분 필요함
  - 개발 환경
    - 소스 코드를 Bind Mount로 연결해 라이브 리로드, 빠른 수정 반영 목적에 적합함
  - 운영 환경
    - 애플리케이션 코드는 Image에 `COPY`로 포함하고
    - DB 데이터, 로그 등만 Volume을 통해 영속화하는 구성이 일반적임
- Volume 우선 사용 권장 사항
  - 영속 데이터, 로그, 캐시 등은 Bind Mount보다 Volume 사용을 우선 고려함
  - Bind Mount는 호스트 디렉터리 구조에 강하게 의존하므로 운영 환경에서는 관리 복잡성이 증가하는 특성이 있음
- 다중 컨테이너 구성 고려 사항
  - 데이터베이스, 애플리케이션, 프록시(Nginx) 등 다중 컨테이너 구성을 사용할 경우
    - 단일 호스트에서도 충분히 운영 가능하지만
    - 고가용성, 스케일 아웃이 필요하면 다중 호스트 + 오케스트레이션(Kubernetes 등) 도입 필요성 존재함
- Multi-stage builds 활용
  - 빌드 전용 단계(Builder)와 실행 전용 단계(Runtime)를 Dockerfile 내에서 분리해 사용함
  - 최종 Image에는 실행에 필요한 산출물만 포함하고, 빌드 도구, 테스트 도구는 포함하지 않아 Image 크기와 공격 면적을 줄이는 효과 있음
- 보안 및 설정 관리
  - Secrets, 환경 변수, 설정 파일은 Image에 직접 하드코딩하지 않고
  - 환경 변수, 외부 설정 파일, Secret 관리 도구를 통해 주입하는 방식 사용 필요성 존재함
